set(HDF5_NAME hdf5)

if(NOT ENABLE_HDF5)
  return()
endif()

tpl_dowload_path( URL ${HDF5_URL} ${TPL_DOWNLOAD_PATH} )

ExternalProject_Add(${HDF5_NAME}
  DEPENDS ${ZLIB_NAME} ${SZIP_NAME}
  URL ${URL}/${HDF5_TGZ}
  URL_MD5 ${HDF5_MD5}
  UPDATE_COMMAND ""
  CMAKE_ARGS
    -DCMAKE_BUILD_TYPE:STRING=${CMAKE_BUILD_TYPE}
    -DCMAKE_CXX_COMPILER:FILEPATH=${CMAKE_CXX_COMPILER}
    -DCMAKE_CXX_FLAGS:STRING=${CMAKE_CXX_FLAGS}
    -DCMAKE_C_COMPILER:FILEPATH=${CMAKE_C_COMPILER}
    -DCMAKE_C_FLAGS:STRING=${CMAKE_C_FLAGS}
    -DBUILD_SHARED_LIBS:BOOL=OFF
    -DBUILD_STATIC_EXECS:BOOL=OFF
    -DBUILD_TESTING:BOOL=OFF
    -DHDF5_BUILD_HL_LIB:BOOL=ON
    -DHDF5_BUILD_CPP_LIB:BOOL=OFF
    -DHDF5_BUILD_FORTRAN:BOOL=OFF
    -DHDF5_BUILD_TOOLS:BOOL=OFF
    -DHDF5_PACKAGE_EXTLIBS:BOOL=ON
    -DHDF5_ENABLE_Z_LIB_SUPPORT:BOOL=ON
    -DZLIB_USE_EXTERNAL:STRING=ON
    -DZLIB_FOUND:STRING=ON
    -DZLIB_PACKAGE_NAME:STRING=${ZLIB_PACKAGE_NAME}
    -DZLIB_INCLUDE_DIR:PATH=${ZLIB_INCLUDE_DIR}
    -DZLIB_LIBRARIES:FILEPATH=${ZLIB_LIBRARIES}
    -DHDF5_ENABLE_SZIP_SUPPORT:BOOL=ON
    -DHDF5_ENABLE_SZIP_ENCODING:BOOL=ON
    -DSZIP_USE_EXTERNAL:STRING=ON
    -DSZIP_FOUND:STRING=ON
    -DSZIP_PACKAGE_NAME:STRING=${SZIP_PACKAGE_NAME}
    -DSZIP_INCLUDE_DIR:PATH=${SZIP_INCLUDE_DIR}
    -DSZIP_LIBRARIES:FILEPATH=${SZIP_LIBRARIES}
    -DCMAKE_INSTALL_PREFIX:PATH=${CMAKE_INSTALL_PREFIX}
)

set(HDF5_INCLUDE_DIR ${CMAKE_INSTALL_PREFIX}/include)
set(HDF5_LIBRARIES     ${CMAKE_INSTALL_PREFIX}/lib/libhdf5.a)
set(HDF5_HL_LIBRARIES  ${CMAKE_INSTALL_PREFIX}/lib/libhdf5_hl.a)
